<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Nex.fun - Meme Token Generator</title>
    <meta name="description" content="Nex.fun lets you deploy meme tokens instantly on-chain. Built on Nexus Network." />
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
  </head>
  <body class="bg-black text-white min-h-screen font-sans">
    <!-- Header -->
    <div class="flex items-center justify-between px-4 py-4 relative">
      <div class="text-xl font-light tracking-wide">Nex.fun</div>
      <div class="relative">
        <div id="walletAddress" class="flex items-center space-x-2 bg-gray-900 px-3 py-1 rounded-full cursor-pointer">
          <div class="w-4 h-4 bg-blue-500 rounded-full"></div>
          <span class="text-sm">Connect Wallet</span>
        </div>
        <div id="walletPopup" class="absolute right-0 mt-2 bg-gray-800 border border-gray-600 p-3 rounded hidden z-50">
          <p class="text-green-400 text-sm mb-2">Connected</p>
          <button onclick="disconnectWallet()" class="bg-red-600 hover:bg-red-700 px-2 py-1 text-xs rounded">Disconnect</button>
        </div>
      </div>
    </div>

    <!-- Form Section -->
    <div class="flex flex-col items-center justify-center px-6 pt-16">
      <p class="text-gray-400 text-sm mb-6 text-center max-w-md leading-relaxed">
        Launch your meme token instantly on-chain.<br />
        No code, no stress â€” just fun.<br />
        Powered by EVM. Built on <span class="text-white font-bold">Nexus Network</span>.
      </p>
      <form id="deployForm" class="space-y-4 w-full max-w-sm flex flex-col items-center">
        <input type="text" id="tokenName" placeholder="Token Name" class="w-full p-2 rounded bg-gray-800 border border-gray-700" />
        <input type="text" id="tokenSymbol" placeholder="Symbol (e.g. JWR)" class="w-full p-2 rounded bg-gray-800 border border-gray-700" />
        <input type="number" id="tokenSupply" placeholder="Total Supply (e.g. 1000000000)" class="w-full p-2 rounded bg-gray-800 border border-gray-700" />
        <button type="submit" class="bg-white text-black font-bold py-2 px-6 rounded hover:bg-gray-200">
          Deploy Token
        </button>
      </form>

      <!-- Buy Token Button -->
      <button onclick="buyToken()" class="bg-white text-black font-bold py-2 px-6 rounded hover:bg-gray-200 mt-6">
        Buy Token
      </button>

      <div id="txResult" class="text-green-400 mt-4 text-center"></div>
    </div>

    <!-- Script Section -->
    <script>
      const provider = new ethers.providers.Web3Provider(window.ethereum);
      const nexusChain = {
        chainId: '0x189',
        chainName: 'Nexus',
        rpcUrls: ['https://rpc.nexus.xyz/http'],
        nativeCurrency: { name: 'Nexus', symbol: 'NEX', decimals: 18 },
        blockExplorerUrls: ['https://nexus-new.explorer.caldera.xyz']
      };

      let isConnected = false;

      async function switchToNexus() {
        try {
          await window.ethereum.request({ method: 'wallet_addEthereumChain', params: [nexusChain] });
        } catch (error) {
          console.error(error);
        }
      }

      async function connectWallet() {
        await provider.send("eth_requestAccounts", []);
        const signer = provider.getSigner();
        const address = await signer.getAddress();
        document.getElementById('walletAddress').innerHTML = `
          <div class="w-4 h-4 bg-blue-500 rounded-full"></div>
          <span class="text-sm">${address.slice(0, 5)}...${address.slice(-3)}</span>`;
        document.getElementById('walletPopup').classList.remove('hidden');
        isConnected = true;
      }

      document.getElementById('walletAddress').addEventListener('click', async () => {
        if (!isConnected) {
          await switchToNexus();
          await connectWallet();
        } else {
          const popup = document.getElementById('walletPopup');
          popup.classList.toggle('hidden');
        }
      });

      function disconnectWallet() {
        isConnected = false;
        document.getElementById('walletPopup').classList.add('hidden');
        document.getElementById('walletAddress').innerHTML = `
          <div class="w-4 h-4 bg-blue-500 rounded-full"></div>
          <span class="text-sm">Connect Wallet</span>`;
      }

      document.getElementById('deployForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        const name = document.getElementById('tokenName').value;
        const symbol = document.getElementById('tokenSymbol').value;
        const supply = document.getElementById('tokenSupply').value;

        const abi = [
          "function name() view returns (string)",
          "function symbol() view returns (string)",
          "function totalSupply() view returns (uint256)",
          "constructor(string memory name, string memory symbol, uint256 initialSupply)"
        ];
        const bytecode = "YOUR_COMPILED_BYTECODE_HERE";

        const factory = new ethers.ContractFactory(abi, bytecode, provider.getSigner());
        const contract = await factory.deploy(name, symbol, ethers.utils.parseUnits(supply, 18));
        await contract.deployTransaction.wait();
        document.getElementById('txResult').innerText = `Token deployed at: ${contract.address}`;
      });

      async function buyToken() {
        const saleAddress = "0xcCd1642e6891b21380997604CaAa2f55774E2734";
        const saleABI = [
          {
            "inputs": [],
            "name": "buyTokens",
            "outputs": [],
            "stateMutability": "payable",
            "type": "function"
          }
        ];
        const signer = provider.getSigner();
        const contract = new ethers.Contract(saleAddress, saleABI, signer);
        const input = prompt("Enter how many NEX you want to spend (e.g. 1):");
        if (!input || isNaN(input)) return;

        try {
          const tx = await contract.buyTokens({ value: ethers.utils.parseEther(input) });
          await tx.wait();
          document.getElementById("txResult").innerText = "Token purchased successfully!";
        } catch (err) {
          console.error(err);
          alert("Transaction failed: " + err.message);
        }
      }
    </script>
  </body>
</html>
