<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Nex.fun - Meme Token Generator</title>
  <meta name="description" content="Create your meme coin instantly on-chain. Powered by Nexus Network."/>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet"/>
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
</head>
<body class="bg-black text-white min-h-screen font-sans">

<!-- Header -->
<div class="flex items-center justify-between px-4 py-4 relative">
  <div class="text-xl font-light tracking-wide">Nex.fun</div>
  <div class="relative">
    <div class="flex items-center space-x-2 bg-gray-900 px-3 py-1 rounded-full cursor-pointer" id="walletAddress">
      <div class="w-4 h-4 bg-blue-500 rounded-full"></div>
      <span class="text-sm">Connect Wallet</span>
    </div>
    <div class="absolute right-0 mt-2 bg-gray-800 border border-gray-600 p-3 rounded hidden z-50" id="walletPopup">
      <p class="text-green-400 text-sm mb-2">Connected</p>
      <button class="bg-red-600 hover:bg-red-700 px-2 py-1 text-xs rounded" onclick="disconnectWallet()">Disconnect</button>
    </div>
  </div>
</div>

<!-- Create Coin Section -->
<div class="max-w-md mx-auto p-6">
  <h2 class="text-xl font-bold mb-4">Create New Coin</h2>
  <form class="space-y-4" id="createCoinForm">
    <input class="w-full p-3 rounded bg-gray-800 border border-gray-700" id="tokenName" placeholder="Coin Name" type="text"/>
    <input class="w-full p-3 rounded bg-gray-800 border border-gray-700" id="tokenSymbol" placeholder="Ticker (e.g. NEX)" type="text"/>
    <textarea class="w-full p-3 rounded bg-gray-800 border border-gray-700" id="tokenDesc" placeholder="Short Description (optional)"></textarea>
    <div class="mb-4">
      <label class="block text-white mb-1 font-medium">
        Add social links <span class="text-gray-400 text-sm">(optional)</span>
        <button class="ml-2 text-white" onclick="toggleLinks()" type="button">+</button>
      </label>
      <div class="hidden mt-2" id="socialLinks">
        <input class="w-full p-2 mb-2 bg-gray-800 text-white rounded" id="websiteUrl" placeholder="Website URL" type="url"/>
        <input class="w-full p-2 mb-2 bg-gray-800 text-white rounded" id="twitterUrl" placeholder="Twitter URL" type="url"/>
        <input class="w-full p-2 mb-2 bg-gray-800 text-white rounded" id="telegramUrl" placeholder="Telegram URL" type="url"/>
      </div>
    </div>
    <button class="w-full bg-white text-black font-bold py-3 rounded hover:bg-gray-200" type="submit">Create Coin</button>
  </form>
  <div class="text-green-400 mt-4 text-center" id="txResult"></div>
  <button class="hidden w-full mt-4 bg-white text-black font-bold py-3 rounded hover:bg-gray-200" id="buyTokenButton" onclick="buyToken()">Buy Token</button>
</div>

<!-- Bottom Navigation -->
<div class="fixed bottom-0 left-0 right-0 bg-black border-t border-gray-700 flex justify-around py-2 z-50">
  <button class="text-white flex flex-col items-center text-sm" onclick="navigateHome()">
    <svg class="w-6 h-6 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M3 12l2-2m0 0l7-7 7 7M13 5v6h6v11H5V11h6V5z" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"></path></svg>
    Home
  </button>
  <button class="text-white bg-white text-black px-4 py-2 rounded-full -mt-6 shadow-lg" onclick="scrollToTop()">+</button>
  <button class="text-white flex flex-col items-center text-sm" onclick="navigateProfile()">
    <svg class="w-6 h-6 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M5.121 17.804A13.937 13.937 0 0112 15c2.21 0 4.29.534 6.121 1.474M15 11a3 3 0 11-6 0 3 3 0 016 0z" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"></path></svg>
    Profile
  </button>
</div>

<script>
  function scrollToTop() {
    window.scrollTo({ top: 0, behavior: 'smooth' });
  }
  function navigateHome() {
    alert("Home clicked!");
  }
  function navigateProfile() {
    alert("Profile clicked!");
  }
  function toggleLinks() {
    const section = document.getElementById('socialLinks');
    section.classList.toggle('hidden');
  }

  const provider = new ethers.providers.Web3Provider(window.ethereum);
  const signer = provider.getSigner();
  const nexusChain = {
    chainId: '0x189',
    chainName: 'Nexus',
    rpcUrls: ['https://rpc.nexus.xyz/http'],
    nativeCurrency: { name: 'Nexus', symbol: 'NEX', decimals: 18 },
    blockExplorerUrls: ['https://nexus-new.explorer.caldera.xyz']
  };

  let isConnected = false;
  let saleAddress = "";

  async function switchToNexus() {
    try {
      await window.ethereum.request({ method: 'wallet_addEthereumChain', params: [nexusChain] });
    } catch (error) {
      console.error(error);
    }
  }

  async function connectWallet() {
    await provider.send("eth_requestAccounts", []);
    const address = await signer.getAddress();
    document.getElementById('walletAddress').innerHTML = `
      <div class="w-4 h-4 bg-blue-500 rounded-full"></div>
      <span class="text-sm">${address.slice(0, 5)}...${address.slice(-3)}</span>`;
    document.getElementById('walletPopup').classList.remove('hidden');
    isConnected = true;
  }

  document.getElementById('walletAddress').addEventListener('click', async () => {
    if (!isConnected) {
      await switchToNexus();
      await connectWallet();
    } else {
      document.getElementById('walletPopup').classList.toggle('hidden');
    }
  });

  function disconnectWallet() {
    isConnected = false;
    document.getElementById('walletPopup').classList.add('hidden');
    document.getElementById('walletAddress').innerHTML = `
      <div class="w-4 h-4 bg-blue-500 rounded-full"></div>
      <span class="text-sm">Connect Wallet</span>`;
  }

  document.getElementById('createCoinForm').addEventListener('submit', async (e) => {
    e.preventDefault();
    const name = document.getElementById('tokenName').value;
    const symbol = document.getElementById('tokenSymbol').value;
    const supply = "1000000000";

    const tokenABI = ["function transfer(address to, uint256 amount) public returns (bool)", "constructor(string memory name, string memory symbol, uint256 initialSupply)"];
    const tokenBytecode = "0x60806040526002805460ff1916601217905534801561001d57600080fd5b506040516106bf3803806106bf83398101604081905261003c916101ba565b825161004f906000906020860190610081565b508151610063906001906020850190610081565b50600381905533600090815260046020526040902055506102749050565b82805461008d90610223565b90600052602060002090601f0160209004810192826100af57600085556100f5565b82601f106100c857805160ff19168380011785556100f5565b828001600101855582156100f5579182015b828111156100f55782518255916020019190600101906100da565b50610101929150610105565b5090565b5b808211156101015760008155600101610106565b600082601f83011261012a578081fd5b81516001600160401b03808211156101445761014461025e565b6040516020601f8401601f19168201810183811183821017156101695761016961025e565b604052838252858401810187101561017f578485fd5b8492505b838310156101a05785830181015182840182015291820191610183565b838311156101b057848185840101525b5095945050505050565b6000806000606084860312156101ce578283fd5b83516001600160401b03808211156101e4578485fd5b6101f08783880161011a565b94506020860151915080821115610205578384fd5b506102128682870161011a565b925050604084015190509250925092565b60028104600182168061023757607f821691505b6020821081141561025857634e487b7160e01b600052602260045260246000fd5b50919050565b634e487b7160e01b600052604160045260246000fd5b61043c806102836000396000f3fe608060405234801561001057600080fd5b50600436106100625760003560e01c806306fdde031461006757806318160ddd14610085578063313ce5671461009a57806370a08231146100af57806395d89b41146100c2578063a9059cbb146100ca575b600080fd5b61006f6100ea565b60405161007c91906102ee565b60405180910390f35b61008d610178565b60405161007c919061036f565b6100a261017e565b60405161007c9190610378565b61008d6100bd366004610299565b610187565b61006f610199565b6100dd6100d83660046102ba565b6101a6565b60405161007c91906102e3565b600080546100f7906103b5565b80601f0160208091040260200160405190810160405280929190818152602001828054610123906103b5565b80156101705780601f1061014557610100808354040283529160200191610170565b820191906000526020600020905b81548152906001019060200180831161015357829003601f168201915b505050505081565b60035481565b60025460ff1681565b60046020526000908152604090205481565b600180546100f7906103b5565b336000908152600460205260408120548211156101de5760405162461bcd60e51b81526004016101d590610341565b60405180910390fd5b33600090815260046020526040812080548492906101fd90849061039e565b90915550506001600160a01b0383166000908152600460205260408120805484929061022a908490610386565b90915550506040516001600160a01b0384169033907fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef9061026c90869061036f565b60405180910390a350600192915050565b80356001600160a01b038116811461029457600080fd5b919050565b6000602082840312156102aa578081fd5b6102b38261027d565b9392505050565b600080604083850312156102cc578081fd5b6102d58361027d565b946020939093013593505050565b901515815260200190565b6000602080835283518082850152825b8181101561031a578581018301518582016040015282016102fe565b8181111561032b5783604083870101525b50601f01601f1916929092016040019392505050565b602080825260149082015273496e73756666696369656e742062616c616e636560601b604082015260600190565b90815260200190565b60ff91909116815260200190565b60008219821115610399576103996103f0565b500190565b6000828210156103b0576103b06103f0565b500390565b6002810460018216806103c957607f821691505b602082108114156103ea57634e487b7160e01b600052602260045260246000fd5b50919050565b634e487b7160e01b600052601160045260246000fdfea2646970667358221220d32bcff40a3fdb79b613fd1462c4eaf133a019d53d4f488ac1032019874d14db64736f6c63430008000033"; // Ganti dengan bytecode token
    const saleABI = ["function buyTokens() public payable", "constructor(address tokenAddress)"];
    const saleBytecode = "0x6080604052655af3107a40006003556402540be40060045534801561002357600080fd5b5060405161095e38038061095e833981016040819052610042916100cb565b61005261004d610077565b61007b565b600180546001600160a01b0319166001600160a01b03929092169190911790556100f9565b3390565b600080546001600160a01b038381166001600160a01b0319831681178455604051919092169283917f8be0079c531659141344cd1fd0a4f28419497f9722a3daafe3b4186f6b6457e09190a35050565b6000602082840312156100dc578081fd5b81516001600160a01b03811681146100f2578182fd5b9392505050565b610856806101086000396000f3fe60806040526004361061009c5760003560e01c8063c7876ea411610064578063c7876ea41461012f578063c8bdbfb614610144578063d0febe4c14610159578063eb91d37e14610161578063f2fde38b14610176578063fc0c546a146101965761009c565b80630f017262146100a1578063629d4ff4146100b8578063715018a6146100e357806383caf275146100f85780638da5cb5b1461010d575b600080fd5b3480156100ad57600080fd5b506100b66101ab565b005b3480156100c457600080fd5b506100cd6101f6565b6040516100da919061079c565b60405180910390f35b3480156100ef57600080fd5b506100b66101fc565b34801561010457600080fd5b506100cd610210565b34801561011957600080fd5b50610122610216565b6040516100da9190610694565b34801561013b57600080fd5b506100cd610225565b34801561015057600080fd5b506100b661022b565b6100b6610344565b34801561016d57600080fd5b506100cd61051e565b34801561018257600080fd5b506100b661019136600461062e565b610555565b3480156101a257600080fd5b5061012261058c565b6101b361059b565b6101bb610216565b6001600160a01b03166108fc479081150290604051600060405180830381858888f193505050501580156101f3573d6000803e3d6000fd5b50565b60025481565b61020461059b565b61020e60006105da565b565b60045481565b6000546001600160a01b031690565b60035481565b61023361059b565b6001546040516370a0823160e01b81526000916001600160a01b0316906370a0823190610264903090600401610694565b60206040518083038186803b15801561027c57600080fd5b505afa158015610290573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052508101906102b4919061067c565b6001549091506001600160a01b031663a9059cbb6102d0610216565b836040518363ffffffff1660e01b81526004016102ee9291906106a8565b602060405180830381600087803b15801561030857600080fd5b505af115801561031c573d6000803e3d6000fd5b505050506040513d601f19601f82011682018060405250810190610340919061065c565b5050565b6000341161036d5760405162461bcd60e51b815260040161036490610707565b60405180910390fd5b600061037761051e565b905060008161038e34670de0b6b3a76400006107eb565b61039891906107cb565b6001546040516370a0823160e01b815291925082916001600160a01b03909116906370a08231906103cd903090600401610694565b60206040518083038186803b1580156103e557600080fd5b505afa1580156103f9573d6000803e3d6000fd5b505050506040513d601f19601f8201168201806040525081019061041d919061067c565b101561043b5760405162461bcd60e51b815260040161036490610737565b346002600082825461044d91906107b3565b909155505060015460405163a9059cbb60e01b81526001600160a01b039091169063a9059cbb9061048490339085906004016106a8565b602060405180830381600087803b15801561049e57600080fd5b505af11580156104b2573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052508101906104d6919061065c565b50336001600160a01b03167f8fafebcaf9d154343dad25669bfa277f4fbacd7ac6b0c4fed522580e040a0f3334836040516105129291906107a5565b60405180910390a25050565b6000670de0b6b3a764000060025460045461053991906107eb565b61054391906107cb565b60035461055091906107b3565b905090565b61055d61059b565b6001600160a01b0381166105835760405162461bcd60e51b8152600401610364906106c1565b6101f3816105da565b6001546001600160a01b031681565b6105a361062a565b6001600160a01b03166105b4610216565b6001600160a01b03161461020e5760405162461bcd60e51b815260040161036490610767565b600080546001600160a01b038381166001600160a01b0319831681178455604051919092169283917f8be0079c531659141344cd1fd0a4f28419497f9722a3daafe3b4186f6b6457e09190a35050565b3390565b60006020828403121561063f578081fd5b81356001600160a01b0381168114610655578182fd5b9392505050565b60006020828403121561066d578081fd5b81518015158114610655578182fd5b60006020828403121561068d578081fd5b5051919050565b6001600160a01b0391909116815260200190565b6001600160a01b03929092168252602082015260400190565b60208082526026908201527f4f776e61626c653a206e6577206f776e657220697320746865207a65726f206160408201526564647265737360d01b606082015260800190565b60208082526016908201527553656e64204e455820746f2062757920746f6b656e7360501b604082015260600190565b602080825260169082015275139bdd08195b9bdd59da081d1bdad95b9cc81b19599d60521b604082015260600190565b6020808252818101527f4f776e61626c653a2063616c6c6572206973206e6f7420746865206f776e6572604082015260600190565b90815260200190565b918252602082015260400190565b600082198211156107c6576107c661080a565b500190565b6000826107e657634e487b7160e01b81526012600452602481fd5b500490565b60008160001904831182151516156108055761080561080a565b500290565b634e487b7160e01b600052601160045260246000fdfea2646970667358221220505791325313dd1d196fc327d1d684aede0ba9531f74c085e2bb3c734ca53d5664736f6c63430008000033"; // Ganti dengan bytecode bonding curve

    try {
      const factoryToken = new ethers.ContractFactory(tokenABI, tokenBytecode, signer);
      const tokenContract = await factoryToken.deploy(name, symbol, ethers.utils.parseUnits(supply, 18));
      await tokenContract.deployed();

      const factorySale = new ethers.ContractFactory(saleABI, saleBytecode, signer);
      const saleContract = await factorySale.deploy(tokenContract.address);
      await saleContract.deployed();

      await tokenContract.transfer(saleContract.address, ethers.utils.parseUnits(supply, 18));

      saleAddress = saleContract.address;
      document.getElementById('txResult').innerText = `Coin deployed at ${tokenContract.address}\nSale at ${saleAddress}`;
      document.getElementById('buyTokenButton').classList.remove('hidden');
    } catch (err) {
      alert("Error: " + err.message);
      console.error(err);
    }
  });

  async function buyToken() {
    const abi = ["function buyTokens() public payable"];
    const contract = new ethers.Contract(saleAddress, abi, signer);
    const input = prompt("Enter how many NEX you want to spend (e.g. 1):");
    if (!input || isNaN(input)) return;
    try {
      const tx = await contract.buyTokens({ value: ethers.utils.parseEther(input) });
      await tx.wait();
      alert("Token purchased successfully!");
    } catch (err) {
      alert("Transaction failed: " + err.message);
    }
  }
</script>
</body>
</html>
