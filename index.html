<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Nex.fun - Meme Token Generator</title>
    <meta name="description" content="Nex.fun lets you deploy meme tokens instantly on-chain. Built on Nexus Network." />
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
  </head>
  <body class="bg-black text-white min-h-screen font-sans">
    <!-- Header -->
    <div class="flex items-center justify-between px-4 py-4 relative">
      <div class="text-xl font-light tracking-wide">Nex.fun</div>
      <div class="relative">
        <div id="walletAddress" class="flex items-center space-x-2 bg-gray-900 px-3 py-1 rounded-full cursor-pointer">
          <div class="w-4 h-4 bg-blue-500 rounded-full"></div>
          <span class="text-sm">Connect Wallet</span>
        </div>
        <div id="walletPopup" class="absolute right-0 mt-2 bg-gray-800 border border-gray-600 p-3 rounded hidden z-50">
          <p class="text-green-400 text-sm mb-2">Connected</p>
          <button onclick="disconnectWallet()" class="bg-red-600 hover:bg-red-700 px-2 py-1 text-xs rounded">Disconnect</button>
        </div>
      </div>
    </div>

    <!-- Form Section -->
    <div class="flex flex-col items-center justify-center px-6 pt-16">
      <p class="text-gray-400 text-sm mb-6 text-center max-w-md leading-relaxed">
        Launch your meme token instantly on-chain.<br />
        No code, no stress â€” just fun.<br />
        Powered by EVM. Built on <span class="text-white font-bold">Nexus Network</span>.
      </p>
      <form id="deployForm" class="space-y-4 w-full max-w-sm flex flex-col items-center">
        <input type="text" id="tokenName" placeholder="Token Name" class="w-full p-2 rounded bg-gray-800 border border-gray-700" />
        <input type="text" id="tokenSymbol" placeholder="Symbol (e.g. JWR)" class="w-full p-2 rounded bg-gray-800 border border-gray-700" />
        <input type="number" id="tokenSupply" placeholder="Total Supply (e.g. 1000000000)" class="w-full p-2 rounded bg-gray-800 border border-gray-700" />
        <button type="submit" class="bg-white text-black font-bold py-2 px-6 rounded hover:bg-gray-200">
          Deploy Token
        </button>
      </form>

      <!-- Buy Token Button -->
      <button onclick="buyToken()" class="bg-white text-black font-bold py-2 px-6 rounded hover:bg-gray-200 mt-6">
        Buy Token
      </button>

      <div id="txResult" class="text-green-400 mt-4 text-center"></div>
    </div>

    <!-- Script Section -->
    <script>
      const provider = new ethers.providers.Web3Provider(window.ethereum);
      const nexusChain = {
        chainId: '0x189',
        chainName: 'Nexus',
        rpcUrls: ['https://rpc.nexus.xyz/http'],
        nativeCurrency: { name: 'Nexus', symbol: 'NEX', decimals: 18 },
        blockExplorerUrls: ['https://nexus-new.explorer.caldera.xyz']
      };

      let isConnected = false;

      async function switchToNexus() {
        try {
          await window.ethereum.request({ method: 'wallet_addEthereumChain', params: [nexusChain] });
        } catch (error) {
          console.error(error);
        }
      }

      async function connectWallet() {
        await provider.send("eth_requestAccounts", []);
        const signer = provider.getSigner();
        const address = await signer.getAddress();
        document.getElementById('walletAddress').innerHTML = `
          <div class="w-4 h-4 bg-blue-500 rounded-full"></div>
          <span class="text-sm">${address.slice(0, 5)}...${address.slice(-3)}</span>`;
        document.getElementById('walletPopup').classList.remove('hidden');
        isConnected = true;
      }

      document.getElementById('walletAddress').addEventListener('click', async () => {
        if (!isConnected) {
          await switchToNexus();
          await connectWallet();
        } else {
          const popup = document.getElementById('walletPopup');
          popup.classList.toggle('hidden');
        }
      });

      function disconnectWallet() {
        isConnected = false;
        document.getElementById('walletPopup').classList.add('hidden');
        document.getElementById('walletAddress').innerHTML = `
          <div class="w-4 h-4 bg-blue-500 rounded-full"></div>
          <span class="text-sm">Connect Wallet</span>`;
      }

      document.getElementById('deployForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        const name = document.getElementById('tokenName').value;
        const symbol = document.getElementById('tokenSymbol').value;
        const supply = document.getElementById('tokenSupply').value;

        const abi = [
          "function name() view returns (string)",
          "function symbol() view returns (string)",
          "function totalSupply() view returns (uint256)",
          "constructor(string memory name, string memory symbol, uint256 initialSupply)"
        ];
        const bytecode = "60806040523480156200001157600080fd5b50604080518082018252600981526826b2b6b2aa37b5b2b760b91b6020808301918252835180850190945260048452634d454d4560e01b9084015281519192916200005f9160039162000182565b5080516200007590600490602084019062000182565b505050620000b0336200008d620000b660201b60201c565b6200009a90600a620002d0565b620000aa90633b9aca00620003c8565b620000bb565b6200043d565b601290565b6001600160a01b038216620000ed5760405162461bcd60e51b8152600401620000e49062000228565b60405180910390fd5b620000fb600083836200017d565b80600260008282546200010f919062000268565b90915550506001600160a01b038216600081815260208190526040808220805485019055517fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef90620001639085906200025f565b60405180910390a362000179600083836200017d565b5050565b505050565b8280546200019090620003ea565b90600052602060002090601f016020900481019282620001b45760008555620001ff565b82601f10620001cf57805160ff1916838001178555620001ff565b82800160010185558215620001ff579182015b82811115620001ff578251825591602001919060010190620001e2565b506200020d92915062000211565b5090565b5b808211156200020d576000815560010162000212565b6020808252601f908201527f45524332303a206d696e7420746f20746865207a65726f206164647265737300604082015260600190565b90815260200190565b600082198211156200027e576200027e62000427565b500190565b80825b6001808611620002975750620002c7565b818704821115620002ac57620002ac62000427565b80861615620002ba57918102915b9490941c93800262000286565b94509492505050565b6000620002e460001960ff851684620002eb565b9392505050565b600082620002fc57506001620002e4565b816200030b57506000620002e4565b81600181146200032457600281146200032f5762000363565b6001915050620002e4565b60ff84111562000343576200034362000427565b6001841b9150848211156200035c576200035c62000427565b50620002e4565b5060208310610133831016604e8410600b84101617156200039b575081810a8381111562000395576200039562000427565b620002e4565b620003aa848484600162000283565b808604821115620003bf57620003bf62000427565b02949350505050565b6000816000190483118215151615620003e557620003e562000427565b500290565b600281046001821680620003ff57607f821691505b602082108114156200042157634e487b7160e01b600052602260045260246000fd5b50919050565b634e487b7160e01b600052601160045260246000fd5b610b0b806200044d6000396000f3fe608060405234801561001057600080fd5b50600436106100cf5760003560e01c806342966c681161008c57806395d89b411161006657806395d89b411461019d578063a457c2d7146101a5578063a9059cbb146101b8578063dd62ed3e146101cb576100cf565b806342966c681461016257806370a082311461017757806379cc67901461018a576100cf565b806306fdde03146100d4578063095ea7b3146100f257806318160ddd1461011257806323b872dd14610127578063313ce5671461013a578063395093511461014f575b600080fd5b6100dc6101de565b6040516100e991906107b9565b60405180910390f35b61010561010036600461076d565b610270565b6040516100e991906107ae565b61011a610292565b6040516100e99190610a5f565b610105610135366004610732565b610298565b6101426102c6565b6040516100e99190610a68565b61010561015d36600461076d565b6102cb565b610175610170366004610796565b6102f7565b005b61011a6101853660046106df565b61030b565b61017561019836600461076d565b61032a565b6100dc61034a565b6101056101b336600461076d565b610359565b6101056101c636600461076d565b6103aa565b61011a6101d9366004610700565b6103c2565b6060600380546101ed90610a9a565b80601f016020809104026020016040519081016040528092919081815260200182805461021990610a9a565b80156102665780601f1061023b57610100808354040283529160200191610266565b820191906000526020600020905b81548152906001019060200180831161024957829003601f168201915b5050505050905090565b60008061027b6103ed565b90506102888185856103f1565b5060019392505050565b60025490565b6000806102a36103ed565b90506102b08582856104a5565b6102bb8585856104ef565b506001949350505050565b601290565b6000806102d66103ed565b90506102888185856102e885896103c2565b6102f29190610a76565b6103f1565b6103086103026103ed565b826105f0565b50565b6001600160a01b0381166000908152602081905260409020545b919050565b61033c826103366103ed565b836104a5565b61034682826105f0565b5050565b6060600480546101ed90610a9a565b6000806103646103ed565b9050600061037282866103c2565b90508381101561039d5760405162461bcd60e51b815260040161039490610a1a565b60405180910390fd5b6102bb82868684036103f1565b6000806103b56103ed565b90506102888185856104ef565b6001600160a01b03918216600090815260016020908152604080832093909416825291909152205490565b3390565b6001600160a01b0383166104175760405162461bcd60e51b8152600401610394906109d6565b6001600160a01b03821661043d5760405162461bcd60e51b815260040161039490610891565b6001600160a01b0380841660008181526001602090815260408083209487168084529490915290819020849055517f8c5be1e5ebec7d5bd14f71427d1e84f3dd0314c0f7b2291e5b200ac8c7c3b92590610498908590610a5f565b60405180910390a3505050565b60006104b184846103c2565b905060001981146104e957818110156104dc5760405162461bcd60e51b8152600401610394906108d3565b6104e984848484036103f1565b50505050565b6001600160a01b0383166105155760405162461bcd60e51b815260040161039490610991565b6001600160a01b03821661053b5760405162461bcd60e51b81526004016103949061080c565b6105468383836106c3565b6001600160a01b0383166000908152602081905260409020548181101561057f5760405162461bcd60e51b81526004016103949061090a565b6001600160a01b0380851660008181526020819052604080822086860390559286168082529083902080548601905591517fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef906105dd908690610a5f565b60405180910390a36104e98484846106c3565b6001600160a01b0382166106165760405162461bcd60e51b815260040161039490610950565b610622826000836106c3565b6001600160a01b0382166000908152602081905260409020548181101561065b5760405162461bcd60e51b81526004016103949061084f565b6001600160a01b0383166000818152602081905260408082208585039055600280548690039055519091907fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef906106b3908690610a5f565b60405180910390a36106c3836000845b505050565b80356001600160a01b038116811461032557600080fd5b6000602082840312156106f0578081fd5b6106f9826106c8565b9392505050565b60008060408385031215610712578081fd5b61071b836106c8565b9150610729602084016106c8565b90509250929050565b600080600060608486031215610746578081fd5b61074f846106c8565b925061075d602085016106c8565b9150604084013590509250925092565b6000806040838503121561077f578182fd5b610788836106c8565b946020939093013593505050565b6000602082840312156107a7578081fd5b5035919050565b901515815260200190565b6000602080835283518082850152825b818110156107e5578581018301518582016040015282016107c9565b818111156107f65783604083870101525b50601f01601f1916929092016040019392505050565b60208082526023908201527f45524332303a207472616e7366657220746f20746865207a65726f206164647260408201526265737360e81b606082015260800190565b60208082526022908201527f45524332303a206275726e20616d6f756e7420657863656564732062616c616e604082015261636560f01b606082015260800190565b60208082526022908201527f45524332303a20617070726f766520746f20746865207a65726f206164647265604082015261737360f01b606082015260800190565b6020808252601d908201527f45524332303a20696e73756666696369656e7420616c6c6f77616e6365000000604082015260600190565b60208082526026908201527f45524332303a207472616e7366657220616d6f756e7420657863656564732062604082015265616c616e636560d01b606082015260800190565b60208082526021908201527f45524332303a206275726e2066726f6d20746865207a65726f206164647265736040820152607360f81b606082015260800190565b60208082526025908201527f45524332303a207472616e736665722066726f6d20746865207a65726f206164604082015264647265737360d81b606082015260800190565b60208082526024908201527f45524332303a20617070726f76652066726f6d20746865207a65726f206164646040820152637265737360e01b606082015260800190565b60208082526025908201527f45524332303a2064656372656173656420616c6c6f77616e63652062656c6f77604082015264207a65726f60d81b606082015260800190565b90815260200190565b60ff91909116815260200190565b60008219821115610a9557634e487b7160e01b81526011600452602481fd5b500190565b600281046001821680610aae57607f821691505b60208210811415610acf57634e487b7160e01b600052602260045260246000fd5b5091905056fea2646970667358221220ee440af4cd71ebba4b60a20122d9b03e572bfd6be5d9daaf9e862b3cb48cef6864736f6c63430008000033";

        const factory = new ethers.ContractFactory(abi, bytecode, provider.getSigner());
        const contract = await factory.deploy(name, symbol, ethers.utils.parseUnits(supply, 18));
        await contract.deployTransaction.wait();
        document.getElementById('txResult').innerText = `Token deployed at: ${contract.address}`;
      });

      async function buyToken() {
        const saleAddress = "0xcCd1642e6891b21380997604CaAa2f55774E2734";
        const saleABI = [
          {
            "inputs": [],
            "name": "buyTokens",
            "outputs": [],
            "stateMutability": "payable",
            "type": "function"
          }
        ];
        const signer = provider.getSigner();
        const contract = new ethers.Contract(saleAddress, saleABI, signer);
        const input = prompt("Enter how many NEX you want to spend (e.g. 1):");
        if (!input || isNaN(input)) return;

        try {
          const tx = await contract.buyTokens({ value: ethers.utils.parseEther(input) });
          await tx.wait();
          document.getElementById("txResult").innerText = "Token purchased successfully!";
        } catch (err) {
          console.error(err);
          alert("Transaction failed: " + err.message);
        }
      }
    </script>
  </body>
</html>
